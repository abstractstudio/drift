var $jscomp={scope:{},getGlobal:function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("WeakMap",function(a){function b(a){$jscomp.owns(a,d)||$jscomp.defineProperty(a,d,{value:{}})}function c(a){var g=Object[a];g&&(Object[a]=function(a){b(a);return g(a)})}if(function(){if(!a||!Object.seal)return!1;try{var c=Object.seal({}),g=Object.seal({}),b=new a([[c,2],[g,3]]);if(2!=b.get(c)||3!=b.get(g))return!1;b.delete(c);b.set(g,4);return!b.has(c)&&4==b.get(g)}catch(d){return!1}}())return a;var d="$jscomp_hidden_"+Math.random().toString().substring(2);c("freeze");c("preventExtensions");
c("seal");var e=0,f=function(a){this.id_=(e+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};f.prototype.set=function(a,c){b(a);if(!$jscomp.owns(a,d))throw Error("WeakMap key fail: "+a);a[d][this.id_]=c;return this};f.prototype.get=function(a){return $jscomp.owns(a,d)?a[d][this.id_]:void 0};f.prototype.has=function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)};f.prototype.delete=
function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)?delete a[d][this.id_]:!1};return f},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done?!1:!0}catch(f){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b=new WeakMap,c=function(a){this.data_={};this.head_=f();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};c.prototype.set=function(a,b){var c=d(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};c.prototype.delete=
function(a){a=d(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};c.prototype.has=function(a){return!!d(this,a).entry};c.prototype.get=function(a){return(a=d(this,a).entry)&&a.value};c.prototype.entries=function(){return e(this,function(a){return[a.key,
a.value]})};c.prototype.keys=function(){return e(this,function(a){return a.key})};c.prototype.values=function(){return e(this,function(a){return a.value})};c.prototype.forEach=function(a,c){for(var b=this.entries(),d;!(d=b.next()).done;)d=d.value,a.call(c,d[1],d[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var d=function(a,c){var d;d=c&&typeof c;"object"==d||"function"==d?b.has(c)?d=b.get(c):(d=""+ ++h,b.set(c,d)):d="p_"+c;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(a=0;a<e.length;a++){var f=
e[a];if(c!==c&&f.key!==f.key||c===f.key)return{id:d,list:e,index:a,entry:f}}return{id:d,list:e,index:-1,entry:void 0}},e=function(a,c){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:c(b)};b=null}return{done:!0,value:void 0}})},f=function(){var a={};return a.previous=a.next=a.head=a},h=0;return c},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),b=new a($jscomp.makeIterator([c]));if(!b.has(c)||1!=b.size||b.add(c)!=b||1!=b.size||b.add({x:4})!=b||2!=b.size)return!1;var e=b.entries(),f=e.next();if(f.done||f.value[0]!=c||f.value[1]!=c)return!1;f=e.next();return f.done||f.value[0]==c||4!=f.value[0].x||f.value[1]!=f.value[0]?!1:e.next().done}catch(h){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};b.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};b.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(a){return this.map_.has(a)};b.prototype.entries=function(){return this.map_.entries()};
b.prototype.values=function(){return this.map_.values()};b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(a,b){var e=this;this.map_.forEach(function(f){return a.call(b,f,f,e)})};return b},"es6-impl","es3");var event={EventManager:{}},EventManager=function(){this.eventListeners={}};EventManager.prototype.addEventListener=function(a,b){void 0===this.eventListeners[a]&&(this.eventListeners[a]=[]);this.eventListeners[a].push(b)};
EventManager.prototype.removeEventListener=function(a,b){this.eventListeners[a].pop(this.eventListeners[a].indexOf(b))};EventManager.prototype.fireEvent=function(a,b){var c;void 0!==(c=this.eventListeners[a])&&c.map(function(a){a(b)})};var animation={Animation:{}},Animation=function(){EventManager.call(this);this._interval=this._src=this.image=null;this._columns=this._rows=1;this.isPlaying=!0;this.isReverse=!1;this.loop=!0;this.frameIndex=this.frameCount=0;this.frameSpeed=40;this.startTime=0};$jscomp.inherits(Animation,EventManager);Animation.prototype.srcset=function(a){this._src=a;this.image=new Image;this.image.onload=this._onload.bind(this);this.image.onerror=this._onerror.bind(this);this.image.src=a};
Animation.prototype._onload=function(a){this.fireEvent("load",a);this.onload(a)};Animation.prototype._onerror=function(a){this.fireEvent("error",a);this.onerror(a)};Animation.prototype._onfinish=function(a){this.fireEvent("finish",a);this.onfinish(a)};Animation.prototype.onload=function(a){};Animation.prototype.onerror=function(a){};Animation.prototype.onfinish=function(a){};
Animation.prototype.play=function(a){var b=this;this.frameIndex=0;this.isPlaying=!0;!1!==a&&(this._interval=setInterval(function(){b._update()},this.frameSpeed))};Animation.prototype._update=function(){this.frameIndex++;this.frameIndex==this.frameCount&&(this.loop?this.frameIndex=0:this._onfinish())};Animation.prototype.update=function(){if(this.isPlaying){var a=Date.now();a-this.start>=this.frameSpeed&&(this.start=a,this._update())}};
Animation.prototype.stop=function(){this._interval&&(clearInterval(this._interval),this._interval=null)};
$jscomp.global.Object.defineProperties(Animation.prototype,{src:{configurable:!0,enumerable:!0,get:function(){return url},set:function(a){return this.srcset(a)}},rows:{configurable:!0,enumerable:!0,get:function(){return this._rows},set:function(a){this.frameCount=(this._rows=a)*this._columns}},columns:{configurable:!0,enumerable:!0,get:function(){return this._columns},set:function(a){this.frameCount=(this._columns=a)*this._rows}},width:{configurable:!0,enumerable:!0,get:function(){return this.image.width/
this._columns}},height:{configurable:!0,enumerable:!0,get:function(){return this.image.height/this._rows}}});CanvasRenderingContext2D.prototype.drawAnimation=function(a,b,c,d,e){var f=a._columns,h=a.frameIndex,g=a.image,k=g.width/f;a=g.height/a._rows;this.drawImage(g,h%f*k,Math.floor(h/f)*a,k,a,b,c,d||k,e||a)};var asset={Asset:{},AssetManager:{}},IMAGE="image",AUDIO="audio",ANIMATION="animation",CREATED=0,LOADING=1,LOADED=2,FAILED=3,Asset=function(a,b,c,d){this.name=a;this.type=b;this.path=c;this.options=d;this.status=CREATED;this.content=null};
Asset.prototype.load=function(a){var b=this;this.status=LOADING;var c=function(){b.status=LOADED;a()},d=function(){b.status=FAILED;a()};this.type==IMAGE?(this.content=new Image,this.content.onload=c,this.content.onerror=d):this.type==AUDIO?(this.content=new Audio,this.content.oncanplaythrough=c,this.content.onerror=d):this.type==ANIMATION&&(this.content=new Animation,this.content.onload=c,this.content.onerror=d);for(var e in this.options)this.options.hasOwnProperty(e)&&(this.content[e]=this.options[e]);
this.content.src=this.path};var AssetManager=function(){EventManager.call(this);this.assetJobs=[];this.assetMap={};this.assetStatus=CREATED};$jscomp.inherits(AssetManager,EventManager);AssetManager.prototype.queueAsset=function(a,b,c,d){this.assetJobs.push(new Asset(a,b,c,d))};
AssetManager.prototype.loadAssets=function(a){var b=this;0==this.assetJobs.length&&a();for(var c in this.assetJobs){var d=this.assetJobs[c];this.assetMap[d.name]=d;d.load(function(){for(var c in b.assetJobs){if(b.assetJobs[c].status<=LOADING)return;b.status=Math.max(b.status,b.assetJobs[c].status)}b.assetJobs=[];a()})}};AssetManager.prototype.getAsset=function(a){if(a in this.assetMap)return this.assetMap[a].content};var control={EngineControls:{}},EngineControls=function(a){AssetManager.call(this);this.canvas=a;this.context=a.getContext("2d");this.originalCanvasWidth=a.width;this.originalCanvasHeight=a.height};$jscomp.inherits(EngineControls,AssetManager);EngineControls.prototype.resizeFullWindow=function(){this.canvas.width=document.body.clientWidth;this.canvas.height=document.body.clientHeight};
EngineControls.prototype.enableFullWindow=function(){var a=this;this.resizeFullWindow();window.addEventListener("resize",function(){a.resizeFullWindow()});document.body.style.overflow="hidden"};EngineControls.prototype.disableFullWindow=function(){this.canvas.width=this.originalCanvasWidth;this.canvas.height=this.originalCanvasHeight};var input={EngineInput:{},KEY:{}},KEY=Object.freeze({CANCEL:3,HELP:6,BACK_SPACE:8,TAB:9,CLEAR:12,RETURN:13,ENTER:14,SHIFT:16,CONTROL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINTSCREEN:44,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,SEMICOLON:59,EQUALS:61,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,CONTEXT_MENU:93,
NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SEPARATOR:108,SUBTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NUM_LOCK:144,SCROLL_LOCK:145,COMMA:188,PERIOD:190,SLASH:191,BACK_QUOTE:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,QUOTE:222,
META:224}),BUTTON=Object.freeze({INITIAL:1,REPEAT:2}),MOUSE=Object.freeze({LEFT:0,RIGHT:2}),IGNORE=new Set([37,39,38,40,32]),EngineInput=function(a){var b=this;EngineControls.call(this,a);a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock;a.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;this.mouse={x:0,y:0};this.keyboard={};this._useMouseCapture=this._isMouseCapturing=this._isMouseCaptured=!1;document.addEventListener("keydown",
function(a){b._onKeyDown(a)});document.addEventListener("keyup",this._onKeyUp.bind(this));document.addEventListener("mousedown",this._onMouseDown.bind(this));document.addEventListener("mouseup",this._onMouseUp.bind(this));document.addEventListener("mousemove",this._onMouseMove.bind(this));this._useMouseCapture&&(this.canvas.addEventListener("mousedown",function(a){b._isMouseCaptured||b.captureMouse()}),this.canvas.addEventListener("pointerlockchange",function(a){b._isMouseCapturing?b._isMouseCapturing=
!1:b.releaseMouse(!0)}))};$jscomp.inherits(EngineInput,EngineControls);EngineInput.prototype.captureMouse=function(){this._isMouseCaptured||(this.canvas.requestPointerLock(),this._isMouseCaptured=this._isMouseCapturing=!0,console.log("capture"))};EngineInput.prototype.releaseMouse=function(a){this._isMouseCaptured&&(this._isMouseCaptured=!1,console.log("release"))};
EngineInput.prototype._onKeyDown=function(a){void 0===this.keyboard[a.keyCode]&&(this.keyboard[a.keyCode]=BUTTON.PRESSED);IGNORE.has(a.keyCode)&&a.preventDefault()};EngineInput.prototype._onKeyUp=function(a){delete this.keyboard[a.keyCode]};EngineInput.prototype._onMouseDown=function(a){this.mouse[a.button]=BUTTON.PRESSED};EngineInput.prototype._onMouseUp=function(a){delete this.mouse[a.button]};
EngineInput.prototype._onMouseMove=function(a){this._isMouseCaptured?(this.mouse.x+=a.movementX||0,this.mouse.y+=a.movementY||0):this._useMouseCapture||(this.mouse.x=a.clientX-(engine.canvas?engine.canvas.offsetLeft+document.body.scrollLeft:0),this.mouse.y=a.clientY-(engine.canvas?engine.canvas.offsetTop+document.body.scrollTop:0))};$jscomp.global.Object.defineProperties(EngineInput.prototype,{isMouseCaptured:{configurable:!0,enumerable:!0,get:function(){return this._isMouseCaptured}}});var engine={Engine:{}},Engine=function(a){EngineInput.call(this,a);this.updateLimit=60;this.updateInterval=1E3/this.updateLimit;this.renderTime=this.updateTime=0;this.renderTrackingCount=20;this.renderTrackingIndex=0;this.renderHistory=Array(this.renderTrackingCount)};$jscomp.inherits(Engine,EngineInput);Engine.prototype._setup=function(){var a=this;this.setup();this.loadAssets(function(){a._load()})};Engine.prototype._load=function(){this.load();this._start()};
Engine.prototype._start=function(){setInterval(this._update.bind(this),this.updateInterval);this._render()};Engine.prototype._update=function(){var a=Date.now()-this.updateTime;this.updateTime=Date.now();this.update(a)};
Engine.prototype._render=function(){requestAnimationFrame(this._render.bind(this));var a=Date.now()-this.renderTime;this.renderTime=Date.now();this.render(this.context);this.renderHistory[this.renderTrackingIndex]=a;this.renderTrackingIndex++;this.renderTrackingIndex==this.renderTrackingCount&&(this.renderTrackingIndex=0)};Engine.prototype.setup=function(){};Engine.prototype.load=function(){};Engine.prototype.update=function(a){};Engine.prototype.render=function(a){};Engine.prototype.stop=function(){};
Engine.prototype.cleanup=function(){};Engine.prototype.main=function(){this._setup()};Engine.prototype.fps=function(){return this.renderHistory.map(function(a){return 1E3/a}).reduce(function(a,b){return a+b},0)/this.renderTrackingCount};
